@base <http://arga.org.au/schemas/fields/>.

@prefix :           <http://arga.org.au/schemas/mapping/>.
@prefix model:      <http://arga.org.au/model/>.
@prefix tsi:        <http://arga.org.au/schemas/maps/tsi/>.
@prefix tsi_model:  <http://arga.org.au/schemas/maps/tsi/model/>.
@prefix bpa:        <http://arga.org.au/schemas/maps/bpa/>.
@prefix bpa_model:  <http://arga.org.au/schemas/maps/bpa/model/>.
@prefix ncbi:       <http://arga.org.au/schemas/maps/ncbi/>.


# The tsi dataset combines subsamples and extractions into one model
# called lab_samples. We transpose a subset of that model into an extraction
tsi_model:lab_samples :models tsi:extractions.
model:lab_samples :models tsi:extractions.

bpa_model:bpa_tsi :models bpa:extractions.
model:bpa_tsi :models bpa:extractions.


ncbi:extractions {
  <entity_id>         :hash ncbi:record_id.
  <subsample_id>      :same bpa:record_id.
  <extract_id>        :same bpa:sample_id.
  <nucleic_acid_type> :same bpa:measurement_method.
}


tsi:extractions {
  <entity_id>                        :hash tsi:lab_sample:extract_id.

  <organism_id>                      :same tsi:organism:entity_id.
  <tissue_id>                        :same tsi:tissues:tissue_id.
  <subsample_id>                     :same tsi:lab_sample:sample_id.
  <extract_id>                       :same tsi:lab_sample:extract_id.

  <extracted_by>                     :same tsi:lab_sample:extracted_by.
  <extracted_by_orcid>               :same tsi:lab_sample:extracted_by_ID.
  <extraction_date>                  :same tsi:lab_sample:extraction_date.

  <nucleic_acid_type>                :same tsi:lab_sample:nucleic_acid_type.
  <nucleic_acid_conformation>        :same tsi:lab_sample:nucleic_acid_conformation.
  <nucleic_acid_preservation_method> :same tsi:lab_sample:nucleic_acid_preservation_method.
  <nucleic_acid_concentration>       :same tsi:lab_sample:nucleic_acid_concentration.
  <nucleic_acid_quantification>      :same tsi:lab_sample:nucleic_acid_quantification.

  <concentration_unit>               :same tsi:lab_sample:extract_concentration_unit.
  <absorbance_260_230_ratio>         :same tsi:lab_sample:absorbance_260_230_ratio.
  <absorbance_260_280_ratio>         :same tsi:lab_sample:absorbance_260_280_ratio.
  <cell_lysis_method>                :same tsi:lab_sample.cell_lysis_method.
  <material_extracted_by>            :same tsi:lab_sample.material_extracted_by.
  <material_extracted_by_orcid>      :same tsi:lab_sample.material_extracted_by_ID.
  <action_extracted>                 :same tsi:lab_sample:action_extracted.
  <extraction_method>                :same tsi:lab_sample:extraction_method.
  <number_of_extracts_pooled>        :same tsi:lab_sample:n_extracts_pooled.

  <citation>                         :same tsi:lab_sample:source.
  <source_url>                       :same tsi:lab_sample:source_URL.
  <doi>                              :same tsi:lab_sample:source_URL.

  # use orcids as the globally unique identifier for agents when available, otherwise fall back
  # to the full name which should be little more than a name due to it's lack of uniqueness
  <extracted_by_entity_id>          :hash_first (<extracted_by_orcid> <extracted_by>).
  <material_extracted_by_entity_id> :hash_first (<material_extracted_by_orcid> <material_extracted_by>).

  <publication_entity_id>           :hash_first (<doi> <citation>).
}


bpa:extractions {
  <entity_id> :hash bpa:sample_id.

  <organism_id> :same bpa:sample_id.
  <subsample_id> :same bpa:sample_id.

  <extract_id> :same bpa:sample_id.

  <extracted_by> :same bpa:dna_extracted_by.
  # dna_extraction_date; genomic_material_preparation_date; material_extraction_date
  <extraction_date> :same bpa:material_extraction_date.

  # material_extraction_type; sample_material_preparation_type
  <nucleic_acid_type> :same bpa:material_extraction_type.
  <nucleic_acid_preservation_method> :same bpa:preservation_type.
  # material_conc_ng_ul; dna_concentration
  <nucleic_acid_concentration> :same bpa:material_conc_ng_ul.

  # <concentration_unit> :same "ng/Âµl".
  <absorbance_260_230_ratio>         :same bpa:absorbance_260_230_ratio.
  <absorbance_260_280_ratio>         :same bpa:absorbance_260_280_ratio.
  # material_extracted_by; dna_extracted_by; genomic_material_prepared_by
  <material_extracted_by>            :same bpa:material_extracted_by.
  # <action_extracted>                 :same "nucleic acid extracted".
  # material_extraction_method; dna_extraction_method; extract_protocol; dna_extraction_protocol
  <extraction_method>                :same bpa:material_extraction_method.


  <extracted_by_entity_id>          :hash_first (<extracted_by>).
  <material_extracted_by_entity_id> :hash_first (<material_extracted_by>).
}
