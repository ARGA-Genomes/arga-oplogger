@base <http://arga.org.au/schemas/fields/>.

@prefix :               <http://arga.org.au/schemas/mapping/>.
@prefix source:         <http://arga.org.au/source/>.
@prefix formats:        <http://arga.org.au/source/formats/>.
@prefix bpa:            <http://arga.org.au/schemas/maps/bpa/>.
@prefix ncbi:           <http://arga.org.au/schemas/maps/ncbi/>.


source:ncbi_taxonomy.csv :discards_lines  1;
                                    :format          formats:tsv;
                                    :transforms_into ncbi:names.

source:bpa.jsonl :format formats:jsonl;
                 :transforms_into bpa:names.


bpa:names
{
  <entity_id>                  :combines (<canonical_name> <scientific_name_authorship>).
  <canonical_name>             :same     bpa:scientific_name.
  <scientific_name_authorship> :same     bpa:scientific_name_authorship.
  <scientific_name>            :combines (<canonical_name> <scientific_name_authorship>).
}


ncbi:names
{
  # the ncbi taxonomy file includes the full hierarchy so we filter the names
  # to only include species
  <entity_id>                  :hash    ncbi:scientific_name;
                               :when << <rank> :is "species" >>.

  <taxon_id>                   :same ncbi:taxon_id.
  <canonical_name>             :same ncbi:canonical_name.
  <scientific_name>            :same ncbi:scientific_name.
  <rank>                       :same ncbi:rank.
}
